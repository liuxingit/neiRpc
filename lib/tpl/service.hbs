/**
 * 类名：{{item.sClassName}}
 */
import { RPCService } from '@kapp/dubbojs';

class {{item.className}} extends RPCService {
   static config(groups) {
       return {
           interface: '{{item.fullClassName}}',
           {{#ifExpress item.protocol 'dubbo'}}
           dubboVersion: '3.0.5.1',
           version: '1.0',
           {{else}}
           jsonRpcVersion: '2.0',
           {{/ifExpress}}
           group: groups.default,
           protocol: '{{item.protocol}}',
           timeout: 3000,
           // 可选
           pool: {
               min: 2,
               max: 10,
               maxWaitingClients: 10,
               keepAlive: true
           }
       }
   };

    {{#each item.paths}}

    /**
     * {{sClassName}}
     * name：{{name}}
     * desc：{{description}}
     * 接口名：/api/{{sClassName}}/{{path}}
     * 负责人：{{realname}}
     */
    public async {{path}}(
        {{~#unless datatypeName~}}
            {{~#each params}}{{~name~}}
                {{#if @last}}{{else}}, {{/if~}}
            {{~/each}}
        {{~else~}}
        {{#ifExpress protocol 'dubbo'}}{{#if datatypeName}}{{datatypeName}}{{else}}params{{/if}}{{else}}params{{/ifExpress}}
        {{~/unless~}}
        ) {
        {{#unless datatypeName}}
            {{#each params}}{{name}}{{#if @last}}{{else}}, {{/if}}{{/each}}
        {{else}}
            params
        {{/unless}}
        {{/ifExpress}}
        );
        {{else}}
        return this.invoke('{{path}}', [ 
        {{#ifExpress protocol 'dubbo'}}
            {{#unless datatypeName}}
            {{#each params}}
            {
                $class: 'java.lang.{{typeName}}',
                $: {{name}}
            {{#if @last}}
            }
            {{else}}
            }, {{/if}}
            {{/each}}
            {{else}}
            {
                $class: '{{datatypeName}}',
                $: {{datatypeName}}
            }
            {{/unless}}
        {{else}}
        {{#unless datatypeName}}
            {{#each params}}{{name}}{{#if @last}}{{else}}, {{/if}}{{/each}}
        {{else}}
            params
        {{/unless}}
        ], [], { 
            retry: 3,
            mock: {
                resCode: 500,
                resDesc: '服务请求失败'
            }
        });
    }
    {{/each}}
}

export default {{item.className}};